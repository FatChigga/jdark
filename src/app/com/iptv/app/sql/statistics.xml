<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="statistics">
	<insert id="saveVideoPlayRecord" parameterType="java.util.HashMap">
		INSERT INTO log_video_play
			(VideoId, VideoName, SellerId, CategoryId, IPAddress, SourceChannel, CreateDate)
		VALUES
			(#{VideoId}, #{VideoName}, #{SellerId}, #{CategoryId}, #{IPAddress}, #{SourceChannel}, #{CreateDate})
	</insert>

	<insert id="saveVideoOperationRecord" parameterType="java.util.HashMap">
		INSERT INTO log_video_operate
			(VideoId, VideoName, SellerId, CategoryId, IPAddress, OperationType,SourceChannel, CreateDate)
		VALUES
			(#{VideoId}, #{VideoName}, #{SellerId}, #{CategoryId}, #{IPAddress}, #{OperationType},
			 #{SourceChannel}, #{CreateDate})
	</insert>

	<insert id="saveSellerOperationRecord" parameterType="java.util.HashMap">
		INSERT INTO log_seller_operate
			(SellerId, SellerName, SellerCode, IPAddress, OperationType, SourceChannel, CreateDate)
		VALUES
			(#{SellerId}, #{SellerName}, #{SellerCode}, #{IPAddress}, #{OperationType}, #{SourceChannel}, #{CreateDate})
	</insert>

	<insert id="saveQrcodeRecord" parameterType="java.util.HashMap">
		INSERT INTO log_qrcode
			(VideoId, VideoName, SellerId, CategoryId, IPAddress, SourceChannel, CreateDate)
		VALUES
			(#{VideoId}, #{VideoName}, #{SellerId}, #{CategoryId}, #{IPAddress}, #{SourceChannel}, #{CreateDate})
	</insert>

	<insert id="savePageVisitRecord" parameterType="java.util.HashMap">
		INSERT INTO log_page_visit
			(IPAddress, PageType, SourceChannel, CreateDate, CategoryId)
		VALUES
			(#{IPAddress}, #{PageType}, #{SourceChannel}, #{CreateDate}, #{CategoryId})
	</insert>
	
	<insert id="saveSearchRecord" parameterType="java.util.HashMap">
		INSERT INTO log_search
			(SearchKey, IsSuccess, NumOfMatched, IPAddress, SourceChannel, CreateDate)
		VALUES
			(#{SearchKey}, #{IsSuccess}, #{NumOfMatched}, #{IPAddress}, #{SourceChannel}, #{CreateDate})
	</insert>
	
	<select id="totalSellerStatistics" resultType="java.util.HashMap">
		SELECT count(1) AS Total,
			ROUND((SELECT count(1) AS YesterDayCount
				   FROM log_seller_operate a
				   WHERE STR_TO_DATE(a.CreateDate, '%Y-%m-%d') = DATE_ADD(CURDATE(),INTERVAL -1 DAY))/count(1)*100,2) AS PerYesterday,
			ROUND((SELECT count(1)
				   FROM log_seller_operate a
				   WHERE STR_TO_DATE(DATE_SUB(a.CreateDate, INTERVAL DAYOFWEEK(a.CreateDate)-2 DAY), '%Y-%m-%d')
					   = STR_TO_DATE(DATE_ADD(DATE_SUB(now(), INTERVAL DAYOFWEEK(NOW())-2 DAY), INTERVAL -1 WEEK), '%Y-%m-%d'))/count(1)*100,2) AS PerLastWeek,
			ROUND((SELECT count(1) AS YesterDayCount
				   FROM log_seller_operate a
				   WHERE STR_TO_DATE(DATE_SUB(a.CreateDate, INTERVAL DAYOFMONTH(a.CreateDate)-1 DAY), '%Y-%m-%d') 
					   = STR_TO_DATE(DATE_ADD(DATE_SUB(now(), INTERVAL DAYOFMONTH(NOW())-1 DAY), INTERVAL -1 MONTH), '%Y-%m-%d'))/count(1)*100,2) AS PerLastMonth
		FROM log_seller_operate x
	</select>
	
	<select id="addedSellerStatistics" resultType="java.util.HashMap">
		SELECT count(1) AS Total,
			ROUND((SELECT count(1) AS YesterDayCount
				   FROM log_seller_operate a
				   WHERE STR_TO_DATE(a.CreateDate, '%Y-%m-%d') = DATE_ADD(CURDATE(),INTERVAL -1 DAY)
				   		AND a.OperationType = 1 )/count(1)*100,2) AS PerYesterday,
			ROUND((SELECT count(1)
				   FROM log_seller_operate a
				   WHERE STR_TO_DATE(DATE_SUB(a.CreateDate, INTERVAL DAYOFWEEK(a.CreateDate)-2 DAY), '%Y-%m-%d')
					   = STR_TO_DATE(DATE_ADD(DATE_SUB(now(), INTERVAL DAYOFWEEK(NOW())-2 DAY), INTERVAL -1 WEEK), '%Y-%m-%d')
					   AND a.OperationType = 1)/count(1)*100,2) AS PerLastWeek,
			ROUND((SELECT count(1) AS YesterDayCount
				   FROM log_seller_operate a
				   WHERE STR_TO_DATE(DATE_SUB(a.CreateDate, INTERVAL DAYOFMONTH(a.CreateDate)-1 DAY), '%Y-%m-%d') 
					   = STR_TO_DATE(DATE_ADD(DATE_SUB(now(), INTERVAL DAYOFMONTH(NOW())-1 DAY), INTERVAL -1 MONTH), '%Y-%m-%d')
					   AND a.OperationType = 1 )/count(1)*100,2) AS PerLastMonth
		FROM log_seller_operate x
		WHERE x.OperationType = 1
	</select>
	
	<select id="videoOfflineStatistics" resultType="java.util.HashMap">
		SELECT count(1) AS Total,
			ROUND((SELECT count(1) AS YesterDayCount
				   FROM log_video_operate a
				   WHERE STR_TO_DATE(a.CreateDate, '%Y-%m-%d') = DATE_ADD(CURDATE(),INTERVAL -1 DAY)
				   		AND a.OperationType = 3 )/count(1)*100,2) AS PerYesterday,
			ROUND((SELECT count(1)
				   FROM log_video_operate a
				   WHERE STR_TO_DATE(DATE_SUB(a.CreateDate, INTERVAL DAYOFWEEK(a.CreateDate)-2 DAY), '%Y-%m-%d')
					   = STR_TO_DATE(DATE_ADD(DATE_SUB(now(), INTERVAL DAYOFWEEK(NOW())-2 DAY), INTERVAL -1 WEEK), '%Y-%m-%d')
					   AND a.OperationType = 3)/count(1)*100,2) AS PerLastWeek,
			ROUND((SELECT count(1) AS YesterDayCount
				   FROM log_video_operate a
				   WHERE STR_TO_DATE(DATE_SUB(a.CreateDate, INTERVAL DAYOFMONTH(a.CreateDate)-1 DAY), '%Y-%m-%d') 
					   = STR_TO_DATE(DATE_ADD(DATE_SUB(now(), INTERVAL DAYOFMONTH(NOW())-1 DAY), INTERVAL -1 MONTH), '%Y-%m-%d')
					   AND a.OperationType = 3 )/count(1)*100,2) AS PerLastMonth,
		   (SELECT count(1) FROM log_video_play) AS TotalPlay
		FROM log_video_operate x
		WHERE x.OperationType = 3
	</select>

	<select id="sellerTotalPaged" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT a.Id,a.Code,a.Name,a.CreateDate,b.Name AS Province,c.Name AS City,d.Name AS Area,
			IFNULL(SELECT count(1) FROM biz_video x WHERE x.`SellerKeyId` = a.Id,0) AS VedioCount
		FROM biz_seller a
		LEFT JOIN sys_region b ON a.Province = b.Id
		LEFT JOIN sys_region c ON a.City = c.Id
		LEFT JOIN sys_region d ON a.Area = d.Id
		WHERE (a.IsDel IS NULL OR a.IsDel = 0) 
		<if test="StartDate != null">
	 		AND str_to_date(a.CreateDate,'%Y-%m-%d') >= str_to_date(#{StartDate},'%Y-%m-%d')
		</if>
		<if test="EndDate != null">
			<![CDATA[ AND str_to_date(a.CreateDate,'%Y-%m-%d') <= str_to_date(#{EndDate},'%Y-%m-%d']]>
		</if>	
		<if test="Province != null and Province != 0">
			AND a.Province = #{Province} 
		</if>
		<if test="City != null and City != 0">
			AND a.City = #{City} 
		</if>
		<if test="Area != null and Area.Size > 0">
	 		AND a.Area IN 
			<foreach collection="Area" index="index" item="item" open="(" separator="," close=")">  
            	#{item}   
			</foreach>
	 	</if>	
		ORDER BY a.OrderNum
	</select>
	
	<select id="getVideoPlayList" resultType="java.util.HashMap">
		SELECT
			IFNULL(round(((SELECT count(1)  FROM log_video_play 
					WHERE (str_to_date(CreateDate,'%Y-%m-%d')
					BETWEEN concat(date_format(LAST_DAY(now() - interval 1 month),'%Y-%m-'),'01')
					AND LAST_DAY(now() - interval 1 month))) /count(1)*100),2),0)
					as PerLastMonth,
			IFNULL(round(((SELECT count(1)  FROM log_video_play 
					WHERE (str_to_date(CreateDate,'%Y-%m-%d') 
					BETWEEN date_sub(curdate(),INTERVAL WEEKDAY(curdate()) + 7 DAY)
					AND date_sub(curdate(),INTERVAL WEEKDAY(curdate())+1 DAY))) /count(1)*100),2),0)
					as PerLastWeek,
			IFNULL(round(((SELECT count(1) from log_video_play a
					WHERE str_to_date(a.CreateDATE,'%Y-%m-%d') = date_sub(curdate(),interval 1 day))/count(1)*100),2),0)
					as PerYesterday,
			count(1) as Total
		FROM  log_video_play x;
	</select>
	
	<select id="getVideoOfflineList" resultType="java.util.HashMap">
		SELECT
			IFNULL(round(((SELECT count(1)  FROM log_video_operate 
					WHERE (str_to_date(CreateDate,'%Y-%m-%d')
					BETWEEN concat(date_format(LAST_DAY(now() - interval 1 month),'%Y-%m-'),'01')
				    AND LAST_DAY(now() - interval 1 month)) AND OperationType = 3) /count(1)*100),2),0) 
				    as PerLastMonth,
			IFNULL(round(((SELECT count(1)  FROM log_video_operate 
			        WHERE (str_to_date(CreateDate,'%Y-%m-%d')
			        BETWEEN date_sub(curdate(),INTERVAL WEEKDAY(curdate()) + 7 DAY)
				    AND date_sub(curdate(),INTERVAL WEEKDAY(curdate())+1 DAY)) AND OperationType = 3 ) /count(1)*100),2),0)  
				    as PerLastWeek,
			IFNULL(round(((SELECT count(1) from log_video_operate a
					WHERE str_to_date(a.CreateDATE,'%Y-%m-%d') = date_sub(curdate(),interval 1 day)
					AND OperationType = 3)/count(1)*100),2),0)  
					as PerYesterday,
			count(1) as Total
		FROM  log_video_operate x WHERE OperationType = 3;
	</select>
	
	<select id="getVideoAddList" resultType="java.util.HashMap">
		SELECT
			IFNULL(round(((SELECT count(1)  FROM log_video_operate 
					WHERE (str_to_date(CreateDate,'%Y-%m-%d')
				    BETWEEN concat(date_format(LAST_DAY(now() - interval 1 month),'%Y-%m-'),'01')
				    AND LAST_DAY(now() - interval 1 month)) AND OperationType = 1) /count(1)*100),2),0)  
				    as PerLastMonth,
			IFNULL(round(((SELECT count(1)  FROM log_video_operate 
					WHERE (str_to_date(CreateDate,'%Y-%m-%d')
					BETWEEN date_sub(curdate(),INTERVAL WEEKDAY(curdate()) + 7 DAY)
				    AND date_sub(curdate(),INTERVAL WEEKDAY(curdate())+1 DAY)) AND OperationType = 1 ) /count(1)*100),2),0)  
				    as PerLastWeek,
			IFNULL(round(((SELECT count(1) from log_video_operate a
					WHERE str_to_date(a.CreateDATE,'%Y-%m-%d') = date_sub(curdate(),interval 1 day) 
					AND OperationType = 1)/count(1)*100),2),0)  
					as PerYesterday,
			count(1) as Total
		FROM  log_video_operate x WHERE OperationType = 1;
	</select>
	
	<select id="getVideoSubmitList" resultType="java.util.HashMap">
		SELECT
			IFNULL(round(((SELECT count(1)  FROM log_video_operate 
					WHERE (CreateDate 
					BETWEEN concat(date_format(LAST_DAY(now() - interval 1 month),'%Y-%m-'),'01')
					AND LAST_DAY(now() - interval 1 month)) AND OperationType = 2) /count(1)*100),2),0)  
					as PerLastMonth,
			IFNULL(round(((SELECT count(1)  FROM log_video_operate 
					WHERE (CreateDate 
					BETWEEN date_sub(curdate(),INTERVAL WEEKDAY(curdate()) + 7 DAY)
					AND date_sub(curdate(),INTERVAL WEEKDAY(curdate())+1 DAY)) AND OperationType = 2 ) /count(1)*100),2),0)  
					as PerLastWeek,
			IFNULL(round(((SELECT count(1) from log_video_operate a
					WHERE str_to_date(a.CreateDATE,'%Y-%m-%d') = date_sub(curdate(),interval 1 day)
					AND OperationType = 2)/count(1)*100),2),0)  
					as PerYesterday,
			count(1) as Total
		FROM  log_video_operate x WHERE OperationType = 2;
	</select>
	
	<select id="getAllVideoCount" resultType="java.util.HashMap">
		SELECT count(1) as Total FROM biz_video a
		WHERE a.IsDel IS NULL OR a.IsDel = 0
	</select>
	
	<select id="getVideoStatistics" resultType="java.util.HashMap" parameterType="java.util.HashMap">
	SELECT str_to_date(a.CreateDate,'%Y-%m-%d') as Date,b.Province,b.City,b.Area,a.Sourcechannel,
		count(1) as playCount,
			(select count(1) from log_qrcode x
				 left join biz_video y on x.VideoId = y.Id
	 			 where str_to_date(x.CreateDATE,'%Y-%m-%d') = str_to_date(a.CreateDATE,'%Y-%m-%d')
				 and y.Province = b.Province and y.City = b.City and y.Area = b.Area) as qrcodeCount
	FROM log_video_play a
	LEFT JOIN biz_video b ON b.Id=a.VideoId
		<where>
		(SELECT 1 FROM biz_video W WHERE W.Id = a.VideoId)=1 
		<if test="SourceChannel != null and SourceChannel.Size>0">
			 AND a.SourceChannel IN 
			<foreach collection="SourceChannel" index="index" item="item" open="(" separator="," close=")">  
            	#{item}   
			 </foreach>
		</if>
		<if test="StartDate != null">
	 		AND str_to_date(a.CreateDate,'%Y-%m-%d')>=#{StartDate}
		</if>
		<if test="EndDate != null">
			AND str_to_date(a.CreateDate,'%Y-%m-%d')<![CDATA[ <= ]]> #{EndDate} 
		</if>	
		<if test="Province != null and Province != 0">
			AND b.Province = #{Province} 
		</if>
		<if test="City != null and City != 0">
			AND b.City = #{City} 
		</if>
		<if test="Area != null and Area.Size>0">
	 		AND b.Area IN 
			<foreach collection="Area" index="index" item="item" open="(" separator="," close=")">  
            	#{item}   
			 </foreach>
	 	</if>	
	 	</where>
	GROUP BY str_to_date(a.CreateDATE,'%Y-%m-%d'),b.Province,b.City, b.Area LIMIT #{startPage},#{endPage}
	</select>
	
	<select id="getVideoDateTimeStatistics" resultType="java.util.HashMap" parameterType="java.util.HashMap">
	SELECT str_to_date(a.CreateDate,'%Y-%m-%d') as Date,b.Province,b.City,b.Area,a.Sourcechannel,
		count(1) as playCount,
			(select count(1) from log_qrcode x
				 left join biz_video y on x.VideoId = y.Id
	 			 where x.CreateDATE = a.CreateDATE
				 and y.Province = b.Province and y.City = b.City and y.Area = b.Area) as qrcodeCount
	FROM log_video_play a
	LEFT JOIN biz_video b ON b.Id=a.VideoId
		<where>
		(SELECT 1 FROM biz_video W WHERE W.Id = a.VideoId)=1 
		<if test="SourceChannel != null and SourceChannel.Size>0">
			AND a.SourceChannel IN 
			<foreach collection="SourceChannel" index="index" item="item" open="(" separator="," close=")">  
            	#{item}   
			 </foreach>
		</if>
		<if test="StartTimeDate != null">
	 		AND a.CreateDate>=#{StartTimeDate}
		</if>
		<if test="EndTimeDate != null">
			AND a.CreateDate<![CDATA[ <= ]]> #{EndTimeDate} 
		</if>	
		<if test="Province != null and Province != 0">
			AND b.Province = #{Province} 
		</if>
		<if test="City != null and City != 0">
			AND b.City = #{City} 
		</if>
		<if test="Area != null and Area.Size>0">
	 		AND b.Area IN 
			<foreach collection="Area" index="index" item="item" open="(" separator="," close=")">  
            	#{item}   
			 </foreach>
	 	</if>	
	 	</where>
	GROUP BY str_to_date(a.CreateDATE,'%Y-%m-%d'),b.Province,b.City, b.Area LIMIT #{startPage},#{endPage}
	</select>
	
	<select id="getVideoDateTimeStatisticsCount" resultType="java.util.HashMap" parameterType="java.util.HashMap">
		SELECT COUNT(*) as total FROM (SELECT
		str_to_date(a.CreateDate,'%Y-%m-%d') as
		Date,b.Province,b.City,b.Area,a.Sourcechannel,
		count(1) as playCount,
		(select count(1) from log_qrcode x
		left join biz_video y on x.VideoId = y.Id
		where x.CreateDATE = a.CreateDATE
			and y.Province = b.Province and y.City = b.City and y.Area = b.Area) as
			qrcodeCount
		FROM log_video_play a
		LEFT JOIN biz_video b ON b.Id=a.VideoId
	<where>
		(SELECT 1 FROM biz_video W WHERE W.Id = a.VideoId)=1
		<if test="SourceChannel != null and SourceChannel.Size>0">
			AND a.SourceChannel IN
			<foreach collection="SourceChannel" index="index" item="item"
				open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="StartTimeDate != null">
			AND a.CreateDate>=#{StartTimeDate}
		</if>
		<if test="EndTimeDate != null">
			AND a.CreateDate<![CDATA[ <= ]]>
			#{EndTimeDate}
		</if>
		<if test="Province != null and Province != 0">
			AND b.Province = #{Province}
		</if>
		<if test="City != null and City != 0">
			AND b.City = #{City}
		</if>
		<if test="Area != null and Area.Size>0">
			AND b.Area IN
			<foreach collection="Area" index="index" item="item" open="("
				separator="," close=")">
				#{item}
			</foreach>
		</if>
	</where>
	GROUP BY str_to_date(a.CreateDATE,'%Y-%m-%d'),b.Province,b.City, b.Area) as total
	</select>
	
	<select id="getVideoStatisticsCount" resultType="java.util.HashMap" parameterType="java.util.HashMap">
		SELECT COUNT(*) as total FROM ( SELECT str_to_date(a.CreateDate,'%Y-%m-%d') as Date,b.Province,b.City,b.Area,a.Sourcechannel,
		count(1) as playCount,
			(select count(1) from log_qrcode x
				 left join biz_video y on x.VideoId = y.Id
	 			 where str_to_date(x.CreateDATE,'%Y-%m-%d') = str_to_date(a.CreateDATE,'%Y-%m-%d')
				 and y.Province = b.Province and y.City = b.City and y.Area = b.Area) as qrcodeCount
				 FROM log_video_play a
	             LEFT JOIN biz_video b ON b.Id=a.VideoId
			<where>
			(SELECT 1 FROM biz_video W WHERE W.Id = a.VideoId)=1
			<if test="SourceChannel != null and SourceChannel.Size>0">
				 AND a.SourceChannel IN 
				<foreach collection="SourceChannel" index="index" item="item" open="(" separator="," close=")">  
            		#{item}   
				 </foreach>
			</if>
			<if test="StartDate != null">
	 			AND str_to_date(a.CreateDate,'%Y-%m-%d')>=#{StartDate}
			</if>
			<if test="EndDate != null">
				AND str_to_date(a.CreateDate,'%Y-%m-%d')<![CDATA[ <= ]]> #{EndDate} 
			</if>	
			<if test="Province != null and Province != 0">
				AND b.Province = #{Province} 
			</if>
			<if test="City != null and City != 0">
				AND b.City = #{City} 
			</if>
			<if test="Area != null and Area.Size>0">
	 			AND b.Area IN 
			<foreach collection="Area" index="index" item="item" open="(" separator="," close=")">  
            	#{item}   
			 </foreach>
	 	</if>	
	 	</where>
	GROUP BY str_to_date(a.CreateDATE,'%Y-%m-%d'),b.Province,b.City, b.Area) as total
	</select>
	
	<select id="getVideoDetailStatistics" resultType="java.util.HashMap" parameterType="java.util.HashMap">
	SELECT str_to_date(a.CreateDATE,'%Y-%m-%d %H') as Date,b.Province,b.City,b.Area,b.status,a.Sourcechannel,
	       a.VideoId,a.VideoName,a.SellerId,c.Name,count(1) as playCount
	FROM log_video_play a
	LEFT JOIN biz_video b ON b.Id=a.VideoId LEFT JOIN biz_seller c ON a.SellerId=c.Id 
		<where>
			(SELECT 1 FROM biz_video W WHERE W.Id = a.VideoId)=1 
			AND (SELECT 1 FROM biz_seller H WHERE H.Id = a.SellerId)=1 
		<if test="SourceChannel != null and SourceChannel.Size>0">
			 AND a.SourceChannel IN 
			<foreach collection="SourceChannel" index="index" item="item" open="(" separator="," close=")">  
            	#{item}   
			 </foreach>
		</if>
		<if test="StartDate != null">
	 		AND str_to_date(a.CreateDate,'%Y-%m-%d')>=#{StartDate}
		</if>
		<if test="EndDate != null">
			AND str_to_date(a.CreateDate,'%Y-%m-%d')<![CDATA[ <= ]]> #{EndDate} 
		</if>	
		<if test="Province != null and Province != 0">
			AND b.Province = #{Province} 
		</if>
		<if test="City != null and City != 0">
			AND b.City = #{City} 
		</if>
		<if test="Area != null and Area.Size>0">
	 		AND b.Area IN 
			<foreach collection="Area" index="index" item="item" open="(" separator="," close=")">  
            	#{item}   
			 </foreach>
	 	</if>	
	 	</where>
	GROUP BY str_to_date(a.CreateDATE,'%Y-%m-%d %H'),b.Province,b.City, b.Area,a.SourceChannel,a.VideoId LIMIT #{startPage},#{endPage}
	</select>
	
	<select id="getVideoDetailStatisticsCount" resultType="java.util.HashMap" parameterType="java.util.HashMap">
	SELECT COUNT(*) as total FROM (SELECT str_to_date(a.CreateDATE,'%Y-%m-%d %H') as Date,b.Province,b.City,b.Area,b.status,a.Sourcechannel,
	       a.VideoId,a.VideoName,a.SellerId,c.Name,count(1) as playCount
	FROM log_video_play a
	LEFT JOIN biz_video b ON b.Id=a.VideoId LEFT JOIN biz_seller c ON a.SellerId=c.Id 
		<where>
			(SELECT 1 FROM biz_video W WHERE W.Id = a.VideoId)=1 
			AND (SELECT 1 FROM biz_seller H WHERE H.Id = a.SellerId)=1 
		<if test="SourceChannel != null and SourceChannel.Size>0">
			AND a.SourceChannel IN 
			<foreach collection="SourceChannel" index="index" item="item" open="(" separator="," close=")">  
            	#{item}   
			 </foreach>
		</if>
		<if test="StartDate != null">
	 		AND str_to_date(a.CreateDate,'%Y-%m-%d')>=#{StartDate}
		</if>
		<if test="EndDate != null">
			AND str_to_date(a.CreateDate,'%Y-%m-%d')<![CDATA[ <= ]]> #{EndDate} 
		</if>	
		<if test="Province != null and Province != 0">
			AND b.Province = #{Province} 
		</if>
		<if test="City != null and City != 0">
			AND b.City = #{City} 
		</if>
		<if test="Area != null and Area.Size>0">
	 		AND b.Area IN 
			<foreach collection="Area" index="index" item="item" open="(" separator="," close=")">  
            	#{item}   
			 </foreach>
	 	</if>	
	 	</where>
	GROUP BY str_to_date(a.CreateDATE,'%Y-%m-%d %H'),b.Province,b.City, b.Area,a.SourceChannel,a.VideoId ) as total
	</select>
</mapper>