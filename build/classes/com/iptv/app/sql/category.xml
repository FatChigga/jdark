<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="category">
	<select id="getRootNodes" resultType="java.util.HashMap">
		<![CDATA[
		SELECT a.Id as id,concat('<span class="pull-right text-primary">[',b.Text,']</span>  ',a.Name) as name,'' as url,true as open,a.Name as CName,a.*
		]]>
		FROM biz_category a
		LEFT JOIN (SELECT x.Text,x.KeyValue FROM sys_dictionary x WHERE x.KeyCode = 'CategoryStatus') b ON a.Status = b.KeyValue 
		WHERE (a.ParentId IS NULL OR a.ParentId = 0) AND (a.IsDel IS NULL OR a.IsDel = 0)
		ORDER BY a.OrderNum
	</select>

	<select id="getNodesByParentID" resultType="java.util.HashMap">
		<![CDATA[
		SELECT a.Id as id,concat('<span class="pull-right text-primary">[',b.Text,']</span>  ',a.Name) as name,'' as url,true as open,a.Name as CName,a.*
		]]>
		FROM biz_category a 
		LEFT JOIN (SELECT x.Text,x.KeyValue FROM sys_dictionary x WHERE x.KeyCode = 'CategoryStatus') b ON a.Status = b.KeyValue 
		WHERE (a.ParentId = #{ParentId}) AND (a.IsDel IS NULL OR a.IsDel = 0)
		ORDER BY a.OrderNum
	</select>

	<select id="getCategoryById" resultType="java.util.HashMap">
		SELECT * FROM biz_category a WHERE a.Id = #{Id}
	</select>

	<insert id="saveCategory" parameterType="java.util.HashMap">
		INSERT INTO biz_category (Code, Name, ParentId, Remark, Status, OrderNum, Level)
		VALUES (#{Code},#{Name}, #{ParentId}, #{Remark}, #{Status}, #{OrderNum}, #{Level})
	</insert>

	<update id="updateCategory" parameterType="java.util.HashMap">
		UPDATE biz_category SET Code = #{Code}, Name = #{Name}, ParentId = #{ParentId},
			Remark = #{Remark}, Status = #{Status}, OrderNum = #{OrderNum}, Level = #{Level}
		WHERE Id = #{Id}
	</update>

	<delete id="deleteCategory" parameterType="java.util.HashMap">
		UPDATE biz_category SET IsDel=1 WHERE Id = #{Id}
	</delete>

	<update id="hideCategory" parameterType="java.util.HashMap">
		UPDATE biz_category SET Status=0 WHERE Id = #{Id}
	</update>

	<update id="syncCategory" parameterType="java.util.HashMap">
		UPDATE biz_category SET Status=2 WHERE Status = 1
	</update>

	<select id="getAllCategory" resultType="java.util.HashMap">
		SELECT a.Name,a.Id,a.Name as text,a.Id as value
	    FROM biz_category a
		WHERE (a.IsDel IS NULL OR a.IsDel = 0) AND a.Status = 2
	    ORDER BY a.OrderNum
	</select>
	
	<select id="getTopCategories" resultType="java.util.HashMap">
		SELECT a.Id,a.Name
	    FROM biz_category a
		WHERE (a.IsDel IS NULL OR a.IsDel = 0) AND a.Status = 2
	    ORDER BY a.OrderNum
		LIMIT 0,7
	</select>
	
</mapper>