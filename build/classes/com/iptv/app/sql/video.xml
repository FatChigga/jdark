<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="video">
	<select id="getAllVideo" resultType="java.util.HashMap">
		SELECT a.* FROM biz_video a
		WHERE a.IsDel IS NULL OR a.IsDel = 0
		ORDER BY a.OrderNum 
	</select>

	<select id="getVideoPaged" resultType="java.util.HashMap">
		SELECT a.*,b.SellerId FROM biz_video a
		LEFT JOIN biz_seller b ON a.SellerKeyId = b.Id
		WHERE (a.IsDel IS NULL OR a.IsDel = 0)
		ORDER BY a.OrderNum DESC
		LIMIT ${offset},${rows}
	</select>

	<select id="getVideoCount" resultType="java.lang.Integer">
		SELECT count(*) as Count FROM biz_video a
		WHERE (a.IsDel IS NULL OR a.IsDel = 0)
		ORDER BY a.OrderNum  DESC
	</select>

	<select id="getVideoById" resultType="java.util.HashMap">
		SELECT a.* FROM biz_video a Where a.Id = #{Id}
	</select>

	<select id="getExistCount" resultType="java.lang.Integer">
		SELECT count(*) as Count FROM biz_video a
		WHERE a.Code = #{Code} AND (a.IsDel IS NULL OR a.IsDel = 0)
	</select>	
	
	<insert id="saveVideo" parameterType="java.util.HashMap">
		INSERT INTO biz_video
			(Code, Name, Jianpin, Quanpin, Cost, CostFZ, VideoUrl, StartDate, EndDate, Style, CategoryId, Description,
			 ImageUrl, GifUrl, QrCode, Province, City, Area, Provider, Maker, Status, CreateDate, SellerKeyId, OrderNum)
		VALUES
			(#{Code}, #{Name}, #{Jianpin}, #{Quanpin}, #{Cost}, #{CostFZ}, <![CDATA[#{VideoUrl}]]>, #{StartDate}, #{EndDate}, #{Style},
			 #{CategoryId}, #{Description}, <![CDATA[#{ImageUrl}]]>, <![CDATA[#{GifUrl}]]>, <![CDATA[#{QrCode}]]>, #{Province}, #{City},
			#{Area}, #{Provider}, #{Maker}, #{Status}, #{CreateDate}, #{SellerKeyId}, #{OrderNum})
	</insert>

	<update id="updateVideo" parameterType="java.util.HashMap">
		UPDATE biz_video SET Code = #{Code}, Name = #{Name}, Jianpin = #{Jianpin}, Quanpin = #{Quanpin}, Cost = #{Cost},
			CostFZ = #{CostFZ}, VideoUrl = <![CDATA[#{VideoUrl}]]>, StartDate = #{StartDate}, EndDate = #{EndDate}, Style = #{Style}, 
			CategoryId = #{CategoryId}, Description = #{Description}, ImageUrl = <![CDATA[#{ImageUrl}]]>, GifUrl = <![CDATA[#{GifUrl}]]>,
			QrCode = <![CDATA[#{QrCode}]]>, Province = #{Province}, City = #{City}, Area = #{Area}, Provider = #{Provider},
			Maker = #{Maker}, SellerKeyId = #{SellerKeyId}, OrderNum = #{OrderNum}
		WHERE Id = #{Id}
	</update>

	<update id="deleteVideo" parameterType="java.util.HashMap">
		UPDATE biz_video SET IsDel = 1
		WHERE Id IN
		 <foreach collection="Id" index="index" item="item" open="(" separator="," close=")">  
            #{item}   
		 </foreach>
	</update>

	<update id="videoOnline" parameterType="java.util.HashMap">
		UPDATE biz_video SET Status = 3
		WHERE Id IN
		 <foreach collection="Id" index="index" item="item" open="(" separator="," close=")">  
            #{item}   
		 </foreach>
	</update>

	<update id="videoOffline" parameterType="java.util.HashMap">
		UPDATE biz_video SET Status = 0
		WHERE Id IN
		 <foreach collection="Id" index="index" item="item" open="(" separator="," close=")">  
            #{item}   
		 </foreach>
	</update>

	<update id="videoSubmit" parameterType="java.util.HashMap">
		UPDATE biz_video SET Status = 2,DxCode = #{DxCode},CorrelateID = #{CorrelateID}
		WHERE Id = #{Id}
	</update>

	<update id="autitSuccess" parameterType="java.util.HashMap">
		UPDATE biz_video SET Status = 3 
		WHERE CorrelateID = #{CorrelateID}
	</update>

	<update id="autitFail" parameterType="java.util.HashMap">
		UPDATE biz_video SET Status = 4 AND Remark = #{Remark}
		WHERE CorrelateID = #{CorrelateID}
	</update>

	<select id="getHomeVideo" resultType="java.util.HashMap">
		SELECT a.Id,a.Name,a.ImageUrl,a.VideoUrl,a.GifUrl FROM biz_video a
		WHERE (a.IsDel IS NULL OR a.IsDel = 0) AND a.Status = 3
		ORDER BY a.OrderNum AND a.CommitDate DESC
		limit 0,9
	</select>

	<select id="getHomeVideoPaged" resultType="java.util.HashMap">
		SELECT a.* FROM biz_video a
		WHERE (a.IsDel IS NULL OR a.IsDel = 0) AND a.Status = 3
		ORDER BY a.OrderNum AND a.CommitDate DESC
		LIMIT ${offset},${rows}
	</select>

	<select id="getHomeVideoPagedCount" resultType="java.lang.Integer">
		SELECT count(1) as Count FROM biz_video a
		WHERE (a.IsDel IS NULL OR a.IsDel = 0) AND a.Status = 3
	</select>

	<select id="getHomeVideoPageNum" resultType="java.lang.Integer">
		SELECT (CEIL((COUNT(1)-9)/${pageSize}) +1) as Num FROM biz_video a
		WHERE (a.IsDel IS NULL OR a.IsDel = 0) AND a.Status = 3
	</select>

	<select id="getHomeVideoForPreview" resultType="java.util.HashMap">
		SELECT * FROM (
			SELECT @rownum:=@rownum+1 AS RowNum,x.* FROM (
				SELECT a.Id,a.Code,a.Name,a.ImageUrl,a.GifUrl,a.VideoUrl,b.Name AS CategoryName 
				FROM biz_video a
				LEFT JOIN biz_category b ON a.CategoryId = b.Id
				WHERE (a.IsDel IS NULL OR a.IsDel = 0) AND a.Status = 3 AND a.CategoryId = #{categoryId}
				ORDER BY a.OrderNum AND a.CommitDate DESC
			) x,(SELECT @rownum:=0) t
		) y WHERE y.RowNum IN (1,6,11)
	</select>
</mapper>